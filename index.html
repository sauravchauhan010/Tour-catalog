<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tour Product Catalog</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap');
        
        :root {
            --primary: #1e293b;
            --accent: #3b82f6;
            --bg-soft: #f8fafc;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-soft);
            color: #1e293b;
            -webkit-font-smoothing: antialiased;
        }

        .catalog-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2.5rem 1.5rem;
        }

        .category-flex-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 2rem;
        }

        .info-card {
            background: white;
            border-radius: 24px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.03);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }

        .info-card:hover {
            transform: translateY(-8px);
            border-color: var(--accent);
            box-shadow: 0 25px 30px -10px rgba(59, 130, 246, 0.15);
        }

        .card-image-container {
            width: 100%;
            height: 280px;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
            background: #f1f5f9;
        }

        .data-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #64748b;
        }

        #detailOverlay, #lightboxOverlay {
            backdrop-filter: blur(16px);
            background-color: rgba(15, 23, 42, 0.85);
        }

        .content-rich ul { list-style-type: disc; margin-left: 1.5rem; }
        .content-rich li { margin-bottom: 0.5rem; }

        .slider-container {
            position: relative;
            overflow: hidden;
            border-radius: 2rem;
            background: #0f172a;
        }
        
        .slider-track {
            display: flex;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .slide {
            flex: 0 0 100%;
            height: 500px;
            cursor: zoom-in;
        }

        .slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .slide:hover img {
            transform: scale(1.03);
        }

        @media print {
            .no-print { display: none; }
            body { background: white; }
            .catalog-container { width: 100%; padding: 0; }
        }
    </style>
</head>
<body>

    <div class="catalog-container">
        <!-- Modern Header -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-12">
            <div>
                <h1 class="text-5xl font-extrabold tracking-tight text-slate-900 mb-2">Tour Catalog</h1>
                <p class="text-slate-500 font-medium text-lg">Rayna B2B Portal</p>
            </div>
            
            <div class="no-print flex items-center gap-3 bg-white p-2.5 rounded-2xl shadow-sm border border-slate-200 w-full md:w-auto">
                <div class="pl-3 text-slate-400">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </div>
                <input 
                    type="text" 
                    id="searchInput"
                    placeholder="Search tours..." 
                    class="bg-transparent px-2 py-2 text-base outline-none w-full md:w-80 font-medium"
                >
            </div>
        </header>

        <!-- Category Filters -->
        <div class="no-print mb-10">
            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">Tour Categories</h3>
            <div class="category-flex-container" id="categoryFilter">
                <button onclick="filterByCategory('all')" class="cat-btn px-6 py-2.5 rounded-full text-sm font-bold transition-all bg-slate-900 text-white shadow-md border border-slate-900" data-category="all">
                    All Tours
                </button>
            </div>
        </div>

        <!-- States -->
        <div id="loadingState" class="py-32 text-center">
            <div class="inline-block w-10 h-10 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-6"></div>
            <p class="text-slate-400 font-bold text-sm tracking-widest uppercase">Fetching Data via Secure Proxy</p>
            <p id="proxyStatus" class="text-xs text-slate-300 mt-2 font-mono"></p>
        </div>

        <div id="errorState" class="hidden py-32 text-center bg-red-50 rounded-3xl border border-red-100 px-6">
            <p class="text-red-600 font-bold text-xl mb-2">Connection Issue Detected</p>
            <p class="text-red-400 mb-6 max-w-md mx-auto">The Rayna API is currently unreachable. This often happens if the CORS proxy is overloaded or if the deployment environment is blocking the request. Check the console for specific error codes.</p>
            <div class="flex flex-col items-center gap-4">
                <button onclick="window.location.reload()" class="bg-red-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-red-700 transition-colors shadow-lg">Retry Connection</button>
                <p id="errorLog" class="text-[10px] font-mono text-red-300 bg-white/50 p-2 rounded-lg max-w-lg"></p>
            </div>
        </div>

        <!-- Grid -->
        <div id="catalogGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-10"></div>

        <div id="emptyState" class="hidden py-32 text-center bg-white rounded-3xl border-2 border-dashed border-slate-200">
            <p class="text-slate-500 font-bold text-xl mb-2">No matches found</p>
            <p class="text-slate-400">Try adjusting your search or category selection.</p>
        </div>
    </div>

    <!-- Detail Overlay -->
    <div id="detailOverlay" class="fixed inset-0 z-[100] hidden overflow-y-auto">
        <div class="min-h-screen flex items-center justify-center p-4 md:p-10">
            <div class="bg-white rounded-[40px] w-full max-w-7xl shadow-2xl relative overflow-hidden border border-slate-200">
                <button onclick="closeDetail()" class="absolute top-8 right-8 bg-slate-900/60 text-white p-4 rounded-full hover:bg-red-500 transition-all z-[120] backdrop-blur-md">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
                <div id="detailContent"></div>
            </div>
        </div>
    </div>

    <!-- Lightbox Overlay -->
    <div id="lightboxOverlay" class="fixed inset-0 z-[200] hidden flex items-center justify-center p-4">
        <button onclick="closeLightbox()" class="absolute top-8 right-8 text-white p-4 hover:bg-white/10 rounded-full transition-all">
            <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
        
        <button onclick="moveLightbox(-1)" class="absolute left-8 text-white p-4 hover:bg-white/10 rounded-full transition-all">
            <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
        </button>
        
        <img id="lightboxImage" class="max-w-full max-h-[90vh] object-contain rounded-xl shadow-2xl" src="" alt="View">
        
        <button onclick="moveLightbox(1)" class="absolute right-8 text-white p-4 hover:bg-white/10 rounded-full transition-all">
            <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
        </button>
        
        <div class="absolute bottom-8 left-0 right-0 text-center text-white/70 font-bold text-sm" id="lightboxCounter"></div>
    </div>

    <script>
        const BASE_URL = 'https://sandbox.raynatours.com';
        const IMAGE_CDN = 'https://d1i3enf1i5tb1f.cloudfront.net';
        const AUTH_TOKEN = "eyJhbGciOiJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGRzaWctbW9yZSNobWFjLXNoYTI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJlYTJlOGU0ZS0zOGQ3LTRjOGMtYjc4YS03MjE4ZWQ0NmFhODIiLCJVc2VySWQiOiI1NDkyMiIsIlVzZXJUeXBlIjoiQWdlbnQiLCJQYXJlbnRJRCI6IjAiLCJFbWFpbElEIjoiYW1pcmo0ampAZ21haWwuY29tIiwiaXNzIjoiaHR0cDovL2RldnJheW5hYXBpLnJheW5hdG91cnMuY29tLyIsImF1ZCI6Imh0dHA6Ly9kZXZyYXluYWFwaS5yYXluYXRvdXJzLmNvbS8ifQ.2GIkNbQ6RO0JZkRPHpLZyUqkNivXlcI1OKSjMs76ufc";

        const COUNTRY_ID = 13063;
        const CITY_ID = 13668;

        let catalogData = [];
        let currentFilter = 'all';
        let currentSlideIndex = 0;
        let activeGalleryImages = [];

        // Enhanced Fetch function with multiple proxies and robust retry logic
        async function secureFetch(endpoint, body) {
            const proxies = [
                'https://corsproxy.io/?',
                'https://api.allorigins.win/raw?url=',
                'https://thingproxy.freeboard.io/fetch/',
                'https://proxy.cors.sh/' // Added as a fourth fallback
            ];

            const targetUrl = `${BASE_URL}${endpoint}`;
            const statusEl = document.getElementById('proxyStatus');
            let lastError = null;

            for (let proxy of proxies) {
                try {
                    if (statusEl) statusEl.innerText = `Trying gateway: ${proxy.split('/')[2]}...`;
                    
                    let fullUrl = targetUrl;
                    if (proxy.includes('corsproxy.io') || proxy.includes('allorigins')) {
                        fullUrl = proxy + encodeURIComponent(targetUrl);
                    } else {
                        fullUrl = proxy + targetUrl;
                    }
                    
                    const response = await fetch(fullUrl, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json', 
                            'Authorization': `Bearer ${AUTH_TOKEN}`,
                            'x-cors-gratis': 'true' // For cors.sh
                        },
                        body: JSON.stringify(body),
                        signal: AbortSignal.timeout(10000) // 10s timeout per proxy
                    });

                    if (!response.ok) {
                        const errText = await response.text().catch(() => 'No response body');
                        console.error(`Status ${response.status} from proxy ${proxy}: ${errText.substring(0, 100)}`);
                        continue;
                    }
                    
                    const data = await response.json();
                    if (data) {
                        if (statusEl) statusEl.innerText = 'Connection established!';
                        return data;
                    }
                } catch (e) {
                    console.warn(`Proxy ${proxy} failed:`, e.message);
                    lastError = e;
                }
            }
            throw lastError || new Error("Connection failed across all available gateways.");
        }

        window.onload = async () => {
            await loadCatalog();
            setupSearch();
        };

        async function loadCatalog() {
            try {
                const result = await secureFetch('/api/Tour/tourstaticdata', { 
                    countryId: COUNTRY_ID, 
                    cityId: CITY_ID 
                });
                
                catalogData = result.data || result.result || [];
                
                if (catalogData.length > 0) {
                    generateCategoryFilters(catalogData);
                    renderCatalog(catalogData);
                    document.getElementById('loadingState').classList.add('hidden');
                } else {
                    throw new Error("API returned an empty data set.");
                }
            } catch (error) {
                console.error("Critical Load Error:", error);
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('errorState').classList.remove('hidden');
                document.getElementById('errorLog').innerText = `Reason: ${error.message}`;
            }
        }

        function getTourTypeConfig(type) {
            const types = {
                'Theme Parks': { bg: 'bg-orange-100', text: 'text-orange-700', icon: 'üé°' },
                'Water Parks': { bg: 'bg-blue-100', text: 'text-blue-700', icon: 'üåä' },
                'Adventure': { bg: 'bg-red-100', text: 'text-red-700', icon: '‚õ∞Ô∏è' },
                'Sightseeing': { bg: 'bg-emerald-100', text: 'text-emerald-700', icon: 'üì∏' },
                'Luxury': { bg: 'bg-purple-100', text: 'text-purple-700', icon: 'üíé' },
                'Dhow Cruise': { bg: 'bg-indigo-100', text: 'text-indigo-700', icon: '‚õµ' },
                'Desert Safari': { bg: 'bg-amber-100', text: 'text-amber-700', icon: 'üèúÔ∏è' }
            };
            return types[type] || { bg: 'bg-slate-100', text: 'text-slate-700', icon: 'üìç' };
        }

        function formatTourType(type) {
            const config = getTourTypeConfig(type);
            return `<span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-[10px] font-bold ${config.bg} ${config.text} border border-black/5"><span>${config.icon}</span> ${type || 'Standard'}</span>`;
        }

        function getFormattedImageUrl(pathOrObj) {
            if (!pathOrObj) return 'https://via.placeholder.com/800x600?text=No+Asset';
            let path = typeof pathOrObj === 'string' ? pathOrObj : (pathOrObj.imagePath || pathOrObj.imageUrl || pathOrObj.thumbImage);
            if (!path) return 'https://via.placeholder.com/800x600?text=Path+Undefined';
            let finalUrl = path.startsWith('http') ? path : `${IMAGE_CDN}/${path.replace(/^\//, '')}`;
            
            if (!finalUrl.toLowerCase().match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
                finalUrl = finalUrl.replace(/\/$/, "") + '_L.jpg';
            }
            return finalUrl;
        }

        function generateCategoryFilters(data) {
            const categories = [...new Set(data.map(item => item.cityTourType).filter(Boolean))];
            const filterContainer = document.getElementById('categoryFilter');
            categories.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = "cat-btn px-6 py-2.5 rounded-full text-sm font-bold transition-all bg-white text-slate-600 border border-slate-200 hover:border-blue-300";
                btn.dataset.category = cat;
                btn.onclick = () => filterByCategory(cat);
                btn.innerText = cat;
                filterContainer.appendChild(btn);
            });
        }

        function filterByCategory(cat) {
            currentFilter = cat;
            document.querySelectorAll('.cat-btn').forEach(btn => {
                const isActive = btn.dataset.category === cat;
                btn.className = isActive ? 
                    "cat-btn px-6 py-2.5 rounded-full text-sm font-bold transition-all bg-slate-900 text-white shadow-md border border-slate-900" : 
                    "cat-btn px-6 py-2.5 rounded-full text-sm font-bold transition-all bg-white text-slate-600 border border-slate-200 hover:border-blue-300";
            });
            const filtered = cat === 'all' ? catalogData : catalogData.filter(item => item.cityTourType === cat);
            renderCatalog(filtered);
        }

        async function fetchDetail(tourId, contractId = 300) {
            const overlay = document.getElementById('detailOverlay');
            overlay.classList.remove('hidden');
            document.getElementById('detailContent').innerHTML = `<div class="py-32 text-center"><div class="inline-block w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div></div>`;
            
            try {
                const detailResult = await secureFetch('/api/Tour/tourStaticDataById', { 
                    countryId: COUNTRY_ID, 
                    cityId: CITY_ID, 
                    tourId, 
                    contractId, 
                    travelDate: "2026/01/09" 
                });
                
                let detail = detailResult.data || detailResult.result;
                const tourDetail = Array.isArray(detail) ? detail[0] : detail;

                const optionsResult = await secureFetch('/api/Tour/touroptionstaticdata', { 
                    tourId, 
                    contractId 
                });
                
                const options = optionsResult.data || optionsResult.result || [];
                renderDetailContent(tourDetail, options);
            } catch (e) {
                document.getElementById('detailContent').innerHTML = `<div class="p-10 text-center text-red-500 font-bold">Error loading details. API may be rate limited.</div>`;
            }
        }

        function renderDetailContent(d, options) {
            const content = document.getElementById('detailContent');
            activeGalleryImages = d.tourImages && d.tourImages.length > 0 ? d.tourImages : [{ imagePath: d.imagePath || d.thumbImage }];
            currentSlideIndex = 0;

            const optionsHtml = options.length > 0 ? options.map((opt, index) => `
                <div class="flex items-center gap-4 py-4 border-b border-slate-100 last:border-0">
                    <div class="w-10 h-10 rounded-xl bg-blue-50 flex items-center justify-center text-blue-700 font-bold text-sm">
                        ${index + 1}
                    </div>
                    <div>
                        <p class="text-lg font-bold text-slate-800">${opt.optionName}</p>
                        <p class="text-xs text-slate-400 font-medium">Standard Experience Available</p>
                    </div>
                </div>
            `).join('') : '<p class="text-slate-400 italic py-6 text-center">Standard options available for this tour.</p>';

            content.innerHTML = `
                <div class="flex flex-col">
                    <div class="relative slider-container">
                        <div class="slider-track" id="sliderTrack">
                            ${activeGalleryImages.map((img, idx) => `
                                <div class="slide" onclick="openLightbox(${idx})">
                                    <img src="${getFormattedImageUrl(img)}" />
                                </div>
                            `).join('')}
                        </div>
                        <div class="absolute inset-0 bg-gradient-to-t from-slate-900/80 via-transparent to-transparent pointer-events-none"></div>
                        
                        ${activeGalleryImages.length > 1 ? `
                        <div class="absolute inset-0 flex items-center justify-between px-6 pointer-events-none">
                            <button onclick="moveSlide(-1)" class="pointer-events-auto bg-black/30 hover:bg-black/50 text-white p-3 rounded-full backdrop-blur-md">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                            </button>
                            <button onclick="moveSlide(1)" class="pointer-events-auto bg-black/30 hover:bg-black/50 text-white p-3 rounded-full backdrop-blur-md">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </button>
                        </div>
                        ` : ''}

                        <div class="absolute bottom-10 left-10 right-10 pointer-events-none">
                            <div class="flex gap-3 mb-4">${formatTourType(d.cityTourType)}</div>
                            <h2 class="text-5xl font-extrabold text-white mb-3 leading-tight">${d.tourName}</h2>
                            <div class="flex items-center gap-6 text-slate-200 text-base font-medium">
                                <span>üìç ${d.cityName}</span>
                                <span>üïí ${d.duration}</span>
                            </div>
                        </div>
                    </div>

                    <div class="p-10 lg:p-14 grid grid-cols-1 lg:grid-cols-3 gap-12">
                        <div class="lg:col-span-2 space-y-12">
                            <section>
                                <h3 class="text-2xl font-extrabold text-slate-900 mb-6 flex items-center gap-3">Tour Details</h3>
                                <div class="text-slate-600 leading-relaxed space-y-6 content-rich text-xl">${d.tourDescription || 'Experience details arriving soon.'}</div>
                            </section>

                            <section class="bg-blue-50/50 rounded-[32px] p-8 border border-blue-100">
                                <h3 class="text-xl font-extrabold text-blue-950 mb-6">What's Included</h3>
                                <div class="text-blue-900 content-rich text-lg">${d.tourInclusion || d.tourInclusions || 'Check tour description for inclusions.'}</div>
                            </section>
                        </div>

                        <div class="space-y-8">
                            <div class="bg-white rounded-[32px] p-8 border border-slate-200 shadow-sm">
                                <h3 class="text-lg font-bold text-slate-900 mb-6">Tour Options</h3>
                                <div class="space-y-1">${optionsHtml}</div>
                            </div>
                            <div class="bg-slate-900 rounded-[32px] p-8 text-white">
                                <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">Availability</p>
                                <p class="text-lg font-bold">Booking open for 2026</p>
                                <button class="w-full bg-blue-600 mt-6 py-4 rounded-2xl font-bold hover:bg-blue-500 transition-colors">Book Now</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCatalog(items) {
            const grid = document.getElementById('catalogGrid');
            const empty = document.getElementById('emptyState');
            
            if (items.length === 0) {
                grid.classList.add('hidden');
                empty.classList.remove('hidden');
                return;
            }
            
            empty.classList.add('hidden');
            grid.classList.remove('hidden');
            grid.innerHTML = items.map(item => `
                <div class="info-card group" onclick="fetchDetail(${item.tourId}, ${item.contractId || 300})">
                    <div class="card-image-container">
                        <img src="${getFormattedImageUrl(item)}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                        <div class="absolute top-4 left-4">
                             ${formatTourType(item.cityTourType)}
                        </div>
                    </div>
                    <div class="p-8 flex flex-col flex-grow">
                        <div class="flex-grow">
                            <h2 class="text-2xl font-extrabold text-slate-900 mb-4 leading-tight group-hover:text-blue-600 transition-colors">${item.tourName}</h2>
                            <div class="flex items-center gap-3 text-slate-500 font-semibold text-sm">
                                üïí ${item.duration}
                            </div>
                        </div>
                        <div class="flex items-center justify-between pt-6 border-t border-slate-100 mt-6">
                            <span class="text-slate-900 font-bold text-sm uppercase">Explore</span>
                            <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center group-hover:bg-blue-600 group-hover:text-white transition-all">
                                ‚Üí
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Lightbox & Slider Utils
        function openLightbox(idx) {
            const lb = document.getElementById('lightboxOverlay');
            const img = document.getElementById('lightboxImage');
            const count = document.getElementById('lightboxCounter');
            lbIdx = idx;
            img.src = getFormattedImageUrl(activeGalleryImages[idx]);
            count.innerText = `${idx + 1} / ${activeGalleryImages.length}`;
            lb.classList.remove('hidden');
        }

        function closeLightbox() { document.getElementById('lightboxOverlay').classList.add('hidden'); }
        function closeDetail() { document.getElementById('detailOverlay').classList.add('hidden'); }

        let lbIdx = 0;
        function moveLightbox(dir) {
            const max = activeGalleryImages.length;
            lbIdx = (lbIdx + dir + max) % max;
            document.getElementById('lightboxImage').src = getFormattedImageUrl(activeGalleryImages[lbIdx]);
            document.getElementById('lightboxCounter').innerText = `${lbIdx + 1} / ${activeGalleryImages.length}`;
        }

        function moveSlide(dir) {
            const track = document.getElementById('sliderTrack');
            const max = activeGalleryImages.length;
            currentSlideIndex = (currentSlideIndex + dir + max) % max;
            track.style.transform = `translateX(-${currentSlideIndex * 100}%)`;
        }

        function setupSearch() {
            document.getElementById('searchInput').addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                const filtered = catalogData.filter(p => {
                    const matchesSearch = (p.tourName || '').toLowerCase().includes(term);
                    const matchesCategory = currentFilter === 'all' || p.cityTourType === currentFilter;
                    return matchesSearch && matchesCategory;
                });
                renderCatalog(filtered);
            });
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') { closeLightbox(); closeDetail(); }
            if (e.key === 'ArrowRight') moveLightbox(1);
            if (e.key === 'ArrowLeft') moveLightbox(-1);
        });
    </script>
</body>
</html>
